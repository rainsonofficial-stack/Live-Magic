<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Magic Live</title>
<style>
  :root{ --bg:#000; --muted:#999; }
  html,body{
    height:100%; margin:0; background:var(--bg); color:#fff;
    font-family:Inter,system-ui,Arial; -webkit-text-size-adjust:100%;
    overflow:hidden;
  }

  /* --- Password Screen --- */
  #passwordScreen {
    position:fixed; inset:0;
    display:flex; align-items:flex-start; justify-content:center;
    padding-top:7vh;
    box-sizing:border-box;
    background: radial-gradient(circle at center,#030303,#000);
    z-index:50;
  }
  .pwCard {
    width:92%; max-width:420px;
    background: rgba(255,255,255,0.02);
    padding:22px; border-radius:14px;
    text-align:center;
    -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
  }
  .hat { font-size:48px; margin-bottom:8px }
  h1 { margin:0 0 6px; font-size:1.25rem; }
  input#magicInput {
    width:100%; padding:14px; font-size:16px; border-radius:10px; border:0;
    background:rgba(255,255,255,0.03); color:#fff; text-align:center;
    margin-top:8px; outline:none;
  }
  button#enterBtn {
    margin-top:14px; width:100%; padding:12px; border-radius:10px; border:0;
    background: linear-gradient(90deg,#ff0080,#7928ca); color:#fff; font-weight:600;
    cursor:pointer;
  }

  /* --- Main Scroll Area --- */
  #main {
    position:fixed; inset:0;
    display:none;
    background:#000;
    overflow:hidden;
  }
  #scroller {
    width:100%; height:100%;
    overflow-y:auto; -webkit-overflow-scrolling:touch;
    scroll-behavior:auto;
    -ms-overflow-style:none; scrollbar-width:none;
  }
  #scroller::-webkit-scrollbar{display:none}
  .slide img {
    width:100%; height:auto; display:block; object-fit:cover;
    -webkit-user-drag:none;
  }

  /* Invisible 3Ã—3 grid overlay */
  #overlay {
    position:fixed; inset:0;
    z-index:40;
    background:transparent;
  }

  /* Optional status (debug hidden by default) */
  #status {
    position:fixed; left:8px; bottom:8px;
    font-size:12px; color:rgba(255,255,255,0.15);
    pointer-events:none; z-index:60;
  }
</style>
</head>

<body>
<!-- Password Screen -->
<div id="passwordScreen">
  <div class="pwCard">
    <div class="hat">ðŸŽ©</div>
    <h1>Witness Live Magic</h1>
    <input id="magicInput" type="text" placeholder="Say the Magic Word" autocomplete="off"/>
    <button id="enterBtn">Enter</button>
  </div>
</div>

<!-- Main Magic Area -->
<div id="main">
  <div id="scroller">
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=101" alt=""></div>
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=102" alt=""></div>
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=103" alt=""></div>
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=104" alt=""></div>
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=105" alt=""></div>
    <div class="slide"><img src="https://picsum.photos/1080/1920?random=106" alt=""></div>
  </div>
  <div id="overlay"></div>
</div>

<div id="status"></div>

<script>
/* CONFIG */
const PASSWORD = "MagicRain";
const MAX_INPUTS = 3;
const USER = "pots";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxbGtdKXfr4U91vymINtxFRa4GDWQ_UBvGR-JdkmqHUHPd6BKbIXDKnrzDMuWWoXq0/exec";

/* ELEMENTS */
const passwordScreen = document.getElementById("passwordScreen");
const main = document.getElementById("main");
const scroller = document.getElementById("scroller");
const overlay = document.getElementById("overlay");
const magicInput = document.getElementById("magicInput");
const enterBtn = document.getElementById("enterBtn");
const status = document.getElementById("status");

/* STATE */
let recorded = [];
let enabled = false;
let touchStart = null;

/* PASSWORD UNLOCK */
enterBtn.addEventListener("click", () => {
  const val = magicInput.value.trim();
  if (val === PASSWORD) {
    passwordScreen.style.display = "none";
    main.style.display = "block";
    enabled = true;
    scroller.scrollTop = 0;
    document.body.style.overflow = "hidden";
  } else {
    magicInput.value = "";
    magicInput.placeholder = "Try again";
    setTimeout(() => (magicInput.placeholder = "Say the Magic Word"), 900);
  }
});

magicInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") enterBtn.click();
});

/* GRID MAPPING */
function coordsToDigit(x, y) {
  const w = window.innerWidth;
  const h = window.innerHeight;
  let col = Math.floor((x / w) * 3);
  let row = Math.floor((y / h) * 3);
  col = Math.min(2, Math.max(0, col));
  row = Math.min(2, Math.max(0, row));
  return row * 3 + col + 1;
}

/* CORS-FREE TRANSMISSION */
function sendCode(code) {
  const url = `${SCRIPT_URL}?user=${encodeURIComponent(USER)}&code=${encodeURIComponent(code)}&_=${Date.now()}`;
  const img = new Image();
  img.src = url; // bypass CORS
  status.textContent = `sent: ${code}`;
  if (navigator.sendBeacon) {
    try { navigator.sendBeacon(SCRIPT_URL + "?user=" + USER + "&code=" + code); } catch(e){}
  }
}

/* TOUCH HANDLERS */
overlay.addEventListener("touchstart", (e) => {
  if (!enabled || recorded.length >= MAX_INPUTS) return;
  const t = e.touches[0];
  touchStart = { x: t.clientX, y: t.clientY };
}, { passive:true });

overlay.addEventListener("touchend", () => {
  if (!enabled || !touchStart || recorded.length >= MAX_INPUTS) return;
  const d = coordsToDigit(touchStart.x, touchStart.y);
  recorded.push(d);
  if (recorded.length === MAX_INPUTS) {
    enabled = false;
    sendCode(recorded.join(""));
  }
  touchStart = null;
}, { passive:true });

/* ORIENTATION FIX */
window.addEventListener("orientationchange", () => {
  setTimeout(() => { scroller.scrollTop = scroller.scrollTop; }, 200);
});
</script>
</body>
</html>
