<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Witness Live Magic</title>
    <!-- Tailwind CSS for styling and responsiveness -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* General Setup */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; 
            color: #c9d1d9;
            /* Prevents double-tap zoom on touch devices */
            touch-action: manipulation; 
        }

        /* -------------------------------------- */
        /* Stealth Page (The Trick View) Elements */
        /* -------------------------------------- */

        /* The container for the 6 scrolling images */
        #image-content {
            min-height: 100vh;
            /* Allows content (images) to be scrolled */
        }
        
        /* The invisible grid that covers the entire screen */
        #tap-grid-overlay {
            position: fixed; /* Stays fixed regardless of scrolling */
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            z-index: 100; /* Ensures it sits on top of all images */
            opacity: 0; /* CRITICAL: Makes the input grid completely invisible */
        }
        .grid-cell {
            /* Large, full-screen touch targets */
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* -------------------------------------- */
        /* Password Page (The Bluff View) Elements */
        /* -------------------------------------- */
        #password-page {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- STAGE 1: PASSWORD PAGE (The Bluff) -->
    <div id="password-page" class="p-6">
        <h1 class="text-4xl font-extrabold text-[#58a6ff] mb-4">WITNESS LIVE MAGIC</h1>
        <p class="text-xl text-gray-400 mb-8">Say the Magic Word...</p>
        
        <input 
            type="password" 
            id="passwordInput" 
            placeholder="Enter Magic Word"
            class="w-full max-w-sm p-3 mb-4 text-lg text-white bg-[#161b22] border border-[#30363d] rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-lg"
        >
        <button 
            id="executeButton" 
            class="w-full max-w-sm p-3 text-lg font-semibold bg-green-600 hover:bg-green-700 rounded-lg shadow-xl transition duration-150 ease-in-out"
        >
            Execute
        </button>
        <p id="passwordStatus" class="mt-4 text-red-400 h-6"></p>
    </div>

    <!-- STAGE 2: STEALTH PAGE (The Input) -->
    <div id="stealth-page" class="hidden">
        
        <!-- Spectator Distraction Content (6 Scrollable Images) -->
        <div id="image-content" class="p-4">
            <h2 class="text-2xl font-bold text-center mb-6 text-[#c9d1d9] sticky top-0 bg-[#0d1117] pt-4 pb-2 z-50">Concentrate on the Prediction Grid</h2>
            
            <p id="statusMessage" class="text-center text-sm font-medium mb-4 h-6 text-yellow-500"></p>

            <!-- Placeholder Images (Using placeholder service for reliability) -->
            <div class="space-y-4">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+1" alt="Placeholder 1" class="w-full h-auto rounded-lg shadow-md">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+2" alt="Placeholder 2" class="w-full h-auto rounded-lg shadow-md">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+3" alt="Placeholder 3" class="w-full h-auto rounded-lg shadow-md">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+4" alt="Placeholder 4" class="w-full h-auto rounded-lg shadow-md">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+5" alt="Placeholder 5" class="w-full h-auto rounded-lg shadow-md">
                <img src="https://placehold.co/600x400/30363d/c9d1d9?text=Image+6" alt="Placeholder 6" class="w-full h-auto rounded-lg shadow-md">
            </div>
            <div class="h-20"></div> <!-- Footer spacing -->
        </div>

        <!-- INVISIBLE INPUT GRID OVERLAY -->
        <div id="tap-grid-overlay">
            <div class="grid-cell" data-value="1"></div>
            <div class="grid-cell" data-value="2"></div>
            <div class="grid-cell" data-value="3"></div>
            <div class="grid-cell" data-value="4"></div>
            <div class="grid-cell" data-value="5"></div>
            <div class="grid-cell" data-value="6"></div>
            <div class="grid-cell" data-value="7"></div>
            <div class="grid-cell" data-value="8"></div>
            <div class="grid-cell" data-value="9"></div>
        </div>

    </div>

<script>
    // --- CONFIGURATION ---
    // !!! CRITICAL: REPLACE THIS WITH YOUR NEW GLITCH/REPLIT SERVER URL !!!
    const API_ENDPOINT_URL = 'YOUR_NEW_GLITCH_OR_REPLIT_URL'; 
    const MAX_CODE_LENGTH = 4;
    const CORRECT_PASSWORD = '6018'; // The magic word to unlock the system

    // --- STATE ---
    let tapSequence = [];
    let currentState = 'PASSWORD_REQUIRED'; // PASSWORD_REQUIRED, CODE_MODE, CODE_SENT_LOCKED

    // --- DOM ELEMENTS ---
    const passwordPage = document.getElementById('password-page');
    const stealthPage = document.getElementById('stealth-page');
    const passwordInput = document.getElementById('passwordInput');
    const executeButton = document.getElementById('executeButton');
    const passwordStatus = document.getElementById('passwordStatus');
    const tapGrid = document.getElementById('tap-grid-overlay');
    const statusMessage = document.getElementById('statusMessage');

    // --- LOGIC ---

    function handlePasswordCheck() {
        if (passwordInput.value === CORRECT_PASSWORD) {
            // Password correct: Transition to the stealth page
            currentState = 'CODE_MODE';
            passwordPage.classList.add('hidden');
            stealthPage.classList.remove('hidden');
            passwordStatus.textContent = '';
            updateStatus('READY_FOR_CODE');
        } else {
            // Password incorrect
            passwordStatus.textContent = "Incorrect. Try again.";
            passwordInput.value = '';
        }
    }

    function handleTap(event) {
        // Prevent default browser behavior (like scrolling/zooming)
        event.preventDefault(); 
        
        const cell = event.target.closest('.grid-cell');
        if (!cell) return;
        
        const value = parseInt(cell.getAttribute('data-value'));

        // 1. Check if we are in the input phase
        if (currentState !== 'CODE_MODE') {
            // Ignore all taps if not in the code entry phase or if locked
            return;
        }

        // 2. Input Logic
        if (tapSequence.length < MAX_CODE_LENGTH) {
            tapSequence.push(value);
            updateStatus('ENTERING_CODE');
            
            // 3. Instant Send on 4th tap
            if (tapSequence.length === MAX_CODE_LENGTH) {
                sendCode(tapSequence.join(''));
                
                // CRITICAL FIX: Lock the system permanently after sending
                currentState = 'CODE_SENT_LOCKED';
                updateStatus('LOCK');
            }
        }
    }

    // --- COMMUNICATION ---

    async function sendCode(code) {
        updateStatus('SENDING');
        
        const paddedCode = code.padStart(MAX_CODE_LENGTH, '0');

        const payload = {
            user: "N/A", 
            code: paddedCode,
        };

        try {
            const response = await fetch(API_ENDPOINT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });

            if (response.status === 204 || response.ok) {
                updateStatus('SUCCESS', paddedCode);
            } else {
                updateStatus('ERROR');
            }
        } catch (error) {
            console.error('Network or communication error:', error);
            updateStatus('ERROR');
        }
    }

    // --- UI/STATUS MANAGEMENT ---

    function updateStatus(mode) {
        const tapCount = tapSequence.length;
        statusMessage.classList.remove('text-green-500', 'text-red-500', 'text-yellow-500');

        if (mode === 'READY_FOR_CODE') {
            statusMessage.textContent = "Prediction Phase Activated. Enter 4 digits.";
            statusMessage.classList.add('text-green-500');
            
        } else if (mode === 'ENTERING_CODE') {
            const remaining = MAX_CODE_LENGTH - tapCount;
            statusMessage.textContent = `Inputting code... ${remaining} taps remaining.`;
            statusMessage.classList.add('text-green-500');

        } else if (mode === 'SENDING') {
            statusMessage.textContent = "Transmitting code to server...";
            statusMessage.classList.add('text-yellow-500');
            
        } else if (mode === 'SUCCESS') {
            statusMessage.textContent = "CODE TRANSMITTED. Prediction set.";
            statusMessage.classList.add('text-green-500');

        } else if (mode === 'LOCK') {
            statusMessage.textContent = "Prediction set. System Locked.";
            statusMessage.classList.add('text-yellow-500');
            
        } else if (mode === 'ERROR') {
            statusMessage.textContent = "TRANSMISSION FAILED. Check server connection.";
            statusMessage.classList.add('text-red-500');
        }
    }

    // --- INITIALIZATION ---

    // Password Page Events
    executeButton.addEventListener('click', handlePasswordCheck);
    passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handlePasswordCheck();
    });

    // Stealth Page Events (Taps on the invisible grid)
    tapGrid.addEventListener('click', handleTap);
    tapGrid.addEventListener('touchstart', (e) => handleTap(e)); // Ensure touch works on mobile

</script>

</body>
</html>
